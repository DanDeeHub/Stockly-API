#!/usr/bin/env bash

# 1ï¸âƒ£ Run tests sequentially (fixes MSB1008 error)
echo "ğŸ§ª Running tests..."
for test_project in ./Tests/*Tests/*.csproj; do
  echo "Testing $test_project..."
  dotnet test "$test_project" --no-restore --verbosity minimal || {
    echo "âŒ Test failed in $test_project - commit aborted!"
    exit 1
  }
done

# 2ï¸âƒ£ Check formatting
echo "ğŸ¨ Checking code formatting..."
dotnet format Stockly-Api.sln --verify-no-changes || {
  echo "âš ï¸  Formatting issues found - applying fixes..."
  dotnet format
  git add -u
  echo "âœ… Fixed formatting - please commit again"
  exit 1
}

echo "ğŸš€ All checks passed!"